_import("billshare");_import("myext");$(document).ready(function(){$("#selOutCategories").hide();$("#rdoTypeIn").click(function(){$("#selInCategories").show();$("#selOutCategories").hide()});$("#rdoTypeOut").click(function(){$("#selOutCategories").show();$("#selInCategories").hide()});$("#rdoSubLevel").click(function(a){if($(".chkType:checked").val()==1){if($("#selInCategories option").size()==0){$("#rdoFirstLevel").attr("checked","true").focus();showMessage("目前没有一级收入项目可选,请先建立一级项目!");a.preventDefault();return false}}else{if($("#selOutCategories option").size()==0){$("#rdoFirstLevel").attr("checked","true").focus();showMessage("目前没有一级支出项目可选,请先建立一级项目!");a.preventDefault();return false}}});$("#btnSave").click(function(){if(validate()){$.ajax({url:"/mybill/category.do?method=addOrUpdate",type:"post",dataType:"json",data:$(".categoryData").input2Json(),success:function(a){showMessage(a.result.message);if(a.result.success=="true"){handleData(a.result.data)}},error:function(){showMessage("服务器繁忙,请稍候再试!")}})}})});function handleData(c){var b;try{reset();if(c.type==0){b=$("#selOutCategories")}else{b=$("#selInCategories")}if(c.parentId==0){var a=$("<option/>");a.val(c.type+"|"+c.id);a.text(c.categoryName);a.appendTo(b).attr("selected","true")}}catch(d){return false}}function reset(){$("#txtCategoryName").val("")}function validate(){if((!$("#txtCategoryName").val())||($.trim($("#txtCategoryName").val())=="")){$("#txtCategoryName").focus();showMessage("必须填写项目名称!");return false}if(($("#txtCategoryName").val()).length>20){$("#txtCategoryName").focus();showMessage("您输入的名称太长，建议名称不超过20个字!");return false}var a=$(".chkType:checked").val();$("#hdnType").val(a);if($("#rdoFirstLevel").is(":checked")){$("#hdnParentId").val("0")}else{if(a==1){if($("#selInCategories option").size()==0){$("#rdoFirstLevel").attr("checked","true").focus();showMessage("目前没有一级收入项目可选,请先建立一级项目!");e.preventDefault();return false}else{$("#hdnParentId").val($("#selInCategories option:selected").val().split("|")[1])}}else{if($("#selOutCategories option").size()==0){$("#rdoFirstLevel").attr("checked","true").focus();showMessage("目前没有一级支出项目可选,请先建立一级项目!");e.preventDefault();return false}else{$("#hdnParentId").val($("#selOutCategories option:selected").val().split("|")[1])}}}return true};